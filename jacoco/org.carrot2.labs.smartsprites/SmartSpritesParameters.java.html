<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SmartSpritesParameters.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">smartsprites</a> &gt; <a href="index.source.html" class="el_package">org.carrot2.labs.smartsprites</a> &gt; <span class="el_source">SmartSpritesParameters.java</span></div><h1>SmartSpritesParameters.java</h1><pre class="source lang-java linenums">/*
 * SmartSprites Project
 *
 * Copyright (C) 2007-2009, Stanisław Osiński.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 * - Redistributions of  source code must  retain the above  copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following  disclaimer in  the documentation  and/or
 *   other materials provided with the distribution.
 *
 * - Neither the name of the SmartSprites Project nor the names of its contributors
 *   may  be used  to endorse  or  promote  products derived   from  this  software
 *   without specific prior written permission.
 *
 * - We kindly request that you include in the end-user documentation provided with
 *   the redistribution and/or in the software itself an acknowledgement equivalent
 *   to  the  following: &quot;This product includes software developed by the SmartSprites
 *   Project.&quot;
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;  AND
 * ANY EXPRESS OR  IMPLIED WARRANTIES, INCLUDING,  BUT NOT LIMITED  TO, THE IMPLIED
 * WARRANTIES  OF  MERCHANTABILITY  AND  FITNESS  FOR  A  PARTICULAR  PURPOSE   ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE  FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL,  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  DAMAGES
 * (INCLUDING, BUT  NOT LIMITED  TO, PROCUREMENT  OF SUBSTITUTE  GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS;  OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND  ON
 * ANY  THEORY  OF  LIABILITY,  WHETHER  IN  CONTRACT,  STRICT  LIABILITY,  OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE)  ARISING IN ANY WAY  OUT OF THE USE  OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
package org.carrot2.labs.smartsprites;

import java.io.File;
import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.nio.file.Path;
import java.util.List;

import org.carrot2.labs.smartsprites.message.Message.MessageLevel;
import org.carrot2.labs.smartsprites.message.Message.MessageType;
import org.carrot2.labs.smartsprites.message.MessageLog;
import org.carrot2.util.FileUtils;
import org.carrot2.util.StringUtils;
import org.kohsuke.args4j.Argument;
import org.kohsuke.args4j.Option;

/**
 * Contains invocation parameters for SmartSprites, provides methods for validating the parameters.
 */
public final class SmartSpritesParameters {
    /**
     * Path to the directory that contains the css files to be processed. Directories containing CSS and image files
     * must be writable, unless output.dir.path is provided. The root.dir.path can be either absolute, e.g.
     * c:/myproject/web or relative to the directory in which this script is run.
     */
    @Option(name = &quot;--root-dir-path&quot;, required = false, metaVar = &quot;DIR&quot;)
    private String rootDir;

    /**
     * Paths to individual CSS files to process. Either {@link #rootDir} or {@link #cssFiles} must be not empty. If only
     * {@link #cssFiles} is not empty, {@link #outputDir} must be blank. If both {@link #rootDir} and {@link #cssFiles}
     * are not empty, {@link #outputDir} is supported but only {@link #cssFiles} from {@link #rootDir} are processed.
     */
    @Argument(metaVar = &quot;CSS-FILES&quot;)
    @Option(name = &quot;--css-files&quot;, required = false, metaVar = &quot;FILES&quot;)
    private List&lt;String&gt; cssFiles;

    /**
     * Output directory for processed CSS files and CSS-relative sprite images. The directory structure relative to
     * root.dir.path will be preserved in the output directory. E.g. if CSS files are contained in the css/base
     * directory of root.dir.path, the processed results will be written to output.dir.path/css/base. Also, CSS-relative
     * sprite images will be written to the output directory. Sprite images with document-root-relative URLs will be
     * written relative to the document.root.dir.path.
     * &lt;p&gt;
     * If the output.dir.path directory does not exist, it will be created.
     * &lt;p&gt;
     * You can leave this property empty, in which case the CSS files will be written next to the original CSS files
     * with css.file.suffix, and sprite images will be written relative to CSS files.
     * &lt;p&gt;
     * If you are using a non-empty output.dir.path, you might want to use an empty css.file.suffix.
     */
    @Option(name = &quot;--output-dir-path&quot;, metaVar = &quot;DIR&quot;)
    private String outputDir;

    /**
     * Document root path for document-root-relative (starting with '/') image urls in CSS. All such image URLs will be
     * taken relative to document.root.dir.path. Also document-root-relative sprite URLs will be written relative to
     * document.root.dir.path. You can leave this property empty if your CSS uses only CSS-relative image URLs. *
     */
    @Option(name = &quot;--document-root-dir-path&quot;, metaVar = &quot;DIR&quot;)
    private String documentRootDir;

    /**
     * Message logging level. If you're getting lots of INFO messages and want to see only warnings, set this option to
     * WARN.
     */
    @Option(name = &quot;--log-level&quot;)
    private MessageLevel logLevel;

    /**
     * The encoding to assume for input and output CSS files.
     */
    @Option(name = &quot;--css-file-encoding&quot;)
    private String cssFileEncoding;

    /**
     * Suffix to be appended to the processed CSS file name.
     */
    @Option(name = &quot;--css-file-suffix&quot;)
    private String cssFileSuffix;

    /**
     * The required depth of the generated PNG sprites.
     */
    @Option(name = &quot;--sprite-png-depth&quot;)
    private PngDepth spritePngDepth;

    /**
     * If &lt;code&gt;true&lt;/code&gt;, SmartSprites will generate the sprite directive indicating that the image is a sprite
     * image.
     */
    @Option(name = &quot;--mark-sprite-images&quot;)
    private boolean markSpriteImages;

    /** The default suffix to be added to the generated CSS files. */
    public static final String DEFAULT_CSS_FILE_SUFFIX = &quot;-sprite&quot;;

    /** By default, we use full color only when necessary. */
<span class="fc" id="L135">    public static final PngDepth DEFAULT_SPRITE_PNG_DEPTH = PngDepth.AUTO;</span>

    /** By default, we'll assume CSS files are UTF-8 encoded. */
<span class="fc" id="L138">    public static final String DEFAULT_CSS_FILE_ENCODING = StandardCharsets.UTF_8.name();</span>

    /** The default logging level. */
<span class="fc" id="L141">    public static final MessageLevel DEFAULT_LOGGING_LEVEL = MessageLevel.INFO;</span>

    /** By default, we don't generate sprite directive in output css. */
    public static final boolean DEFAULT_MARK_SPRITE_IMAGES = false;

    /**
     * The Enum PngDepth.
     */
<span class="fc" id="L149">    public enum PngDepth {</span>

        /** The auto. */
<span class="fc" id="L152">        AUTO,</span>
        /** The indexed. */
<span class="fc" id="L154">        INDEXED,</span>
        /** The direct. */
<span class="fc" id="L156">        DIRECT;</span>
    }

    /**
     * Creates the parameters with default options and null root dir, before root dir is set, the parameters are
     * invalid.
     */
    public SmartSpritesParameters() {
<span class="nc" id="L164">        this(null);</span>
<span class="nc" id="L165">    }</span>

    /**
     * Creates the parameters with most default values.
     *
     * @param rootDir
     *            the root dir
     */
    public SmartSpritesParameters(String rootDir) {
<span class="nc" id="L174">        this(rootDir, null, null, null, MessageLevel.INFO, DEFAULT_CSS_FILE_SUFFIX, DEFAULT_SPRITE_PNG_DEPTH,</span>
                DEFAULT_CSS_FILE_ENCODING, DEFAULT_MARK_SPRITE_IMAGES);
<span class="nc" id="L176">    }</span>

    /**
     * Creates the parameters.
     *
     * @param rootDir
     *            the root dir
     * @param cssFiles
     *            the css files
     * @param outputDir
     *            the output dir
     * @param documentRootDir
     *            the document root dir
     * @param logLevel
     *            the log level
     * @param cssFileSuffix
     *            the css file suffix
     * @param spritePngDepth
     *            the sprite png depth
     * @param cssEncoding
     *            the css encoding
     */
    public SmartSpritesParameters(String rootDir, List&lt;String&gt; cssFiles, String outputDir, String documentRootDir,
            MessageLevel logLevel, String cssFileSuffix, PngDepth spritePngDepth, String cssEncoding) {
<span class="fc" id="L200">        this(rootDir, cssFiles, outputDir, documentRootDir, logLevel, cssFileSuffix, spritePngDepth, cssEncoding,</span>
                DEFAULT_MARK_SPRITE_IMAGES);
<span class="fc" id="L202">    }</span>

    /**
     * Creates the parameters.
     *
     * @param rootDir
     *            the root dir
     * @param cssFiles
     *            the css files
     * @param outputDir
     *            the output dir
     * @param documentRootDir
     *            the document root dir
     * @param logLevel
     *            the log level
     * @param cssFileSuffix
     *            the css file suffix
     * @param spritePngDepth
     *            the sprite png depth
     * @param cssEncoding
     *            the css encoding
     * @param markSpriteImages
     *            the mark sprite images
     */
    public SmartSpritesParameters(String rootDir, List&lt;String&gt; cssFiles, String outputDir, String documentRootDir,
            MessageLevel logLevel, String cssFileSuffix, PngDepth spritePngDepth, String cssEncoding,
<span class="fc" id="L228">            boolean markSpriteImages) {</span>
<span class="fc" id="L229">        this.rootDir = rootDir;</span>
<span class="fc" id="L230">        this.cssFiles = cssFiles;</span>
<span class="fc" id="L231">        this.outputDir = outputDir;</span>
<span class="fc" id="L232">        this.documentRootDir = documentRootDir;</span>
<span class="fc" id="L233">        this.logLevel = logLevel;</span>
<span class="fc" id="L234">        this.cssFileEncoding = cssEncoding;</span>
<span class="fc" id="L235">        this.cssFileSuffix = getCssFileSuffix(cssFileSuffix);</span>
<span class="fc" id="L236">        this.spritePngDepth = spritePngDepth;</span>
<span class="fc" id="L237">        this.markSpriteImages = markSpriteImages;</span>
<span class="fc" id="L238">    }</span>

    /**
     * Validates the provided parameters. All resource paths are resolved against the local file system.
     *
     * @param log
     *            the log
     *
     * @return &lt;code&gt;true&lt;/code&gt; if the parameters are valid
     */
    public boolean validate(MessageLog log) {
<span class="fc" id="L249">        boolean valid = true;</span>

        // Either root dir or css files are required
<span class="fc bfc" id="L252" title="All 4 branches covered.">        if (!hasRootDir() &amp;&amp; !hasCssFiles()) {</span>
<span class="fc" id="L253">            log.error(MessageType.EITHER_ROOT_DIR_OR_CSS_FILES_IS_REQUIRED);</span>
<span class="fc" id="L254">            return false;</span>
        }

        // If there is no output dir, we can't have both root dir or css files
<span class="fc bfc" id="L258" title="All 6 branches covered.">        if (!hasOutputDir() &amp;&amp; hasRootDir() &amp;&amp; hasCssFiles()) {</span>
<span class="fc" id="L259">            log.error(MessageType.ROOT_DIR_AND_CSS_FILES_CANNOT_BE_BOTH_SPECIFIED_UNLESS_WITH_OUTPUT_DIR);</span>
<span class="fc" id="L260">            return false;</span>
        }

        // Check root dir if provided
<span class="fc bfc" id="L264" title="All 2 branches covered.">        if (hasRootDir()) {</span>
<span class="fc" id="L265">            final File directory = FileUtils.getCanonicalOrAbsoluteFile(this.rootDir);</span>
<span class="pc bpc" id="L266" title="1 of 4 branches missed.">            if (!directory.exists() || !directory.isDirectory()) {</span>
<span class="fc" id="L267">                log.error(MessageType.ROOT_DIR_DOES_NOT_EXIST_OR_IS_NOT_DIRECTORY, this.rootDir);</span>
<span class="fc" id="L268">                valid = false;</span>
            }
        }

        // Check output dir if provided
<span class="fc bfc" id="L273" title="All 2 branches covered.">        if (hasOutputDir()) {</span>
            // For output dir, we need root dir
<span class="fc bfc" id="L275" title="All 2 branches covered.">            if (!hasRootDir()) {</span>
<span class="fc" id="L276">                log.error(MessageType.ROOT_DIR_IS_REQUIRED_FOR_OUTPUT_DIR);</span>
<span class="fc" id="L277">                return false;</span>
            }

<span class="fc" id="L280">            final File directory = FileUtils.getCanonicalOrAbsoluteFile(this.outputDir);</span>
<span class="fc bfc" id="L281" title="All 4 branches covered.">            if (directory.exists() &amp;&amp; !directory.isDirectory()) {</span>
<span class="fc" id="L282">                log.error(MessageType.OUTPUT_DIR_IS_NOT_DIRECTORY, this.outputDir);</span>
<span class="fc" id="L283">                valid = false;</span>
            }
        }

<span class="fc bfc" id="L287" title="All 4 branches covered.">        if (!hasOutputDir() &amp;&amp; StringUtils.isBlank(cssFileSuffix)) {</span>
<span class="fc" id="L288">            log.error(MessageType.CSS_FILE_SUFFIX_IS_REQUIRED_IF_NO_OUTPUT_DIR);</span>
<span class="fc" id="L289">            valid = false;</span>
        }

<span class="fc bfc" id="L292" title="All 2 branches covered.">        if (hasDocumentRootDir()) {</span>
<span class="fc" id="L293">            final File directory = FileUtils.getCanonicalOrAbsoluteFile(this.documentRootDir);</span>
<span class="fc bfc" id="L294" title="All 4 branches covered.">            if (!directory.exists() || !directory.isDirectory()) {</span>
<span class="fc" id="L295">                log.error(MessageType.DOCUMENT_ROOT_DIR_DOES_NOT_EXIST_OR_IS_NOT_DIRECTORY, this.documentRootDir);</span>
<span class="fc" id="L296">                valid = false;</span>
            }
        }

<span class="fc" id="L300">        return valid;</span>
    }

    /**
     * Gets the css file suffix.
     *
     * @param suffix
     *            the suffix
     *
     * @return the css file suffix
     */
    private String getCssFileSuffix(String suffix) {
<span class="fc bfc" id="L312" title="All 2 branches covered.">        if (suffix != null) {</span>
<span class="fc" id="L313">            return suffix;</span>
        }
<span class="fc bfc" id="L315" title="All 2 branches covered.">        if (!hasOutputDir()) {</span>
            // If there is no output dir, we must have some suffix
<span class="fc" id="L317">            return DEFAULT_CSS_FILE_SUFFIX;</span>
        }
        // If we have an output dir, we can have an empty suffix
<span class="fc" id="L320">        return &quot;&quot;;</span>
    }

    /**
     * Gets the root dir.
     *
     * @return the root dir
     */
    public String getRootDir() {
<span class="fc" id="L329">        return rootDir;</span>
    }

    /**
     * Gets the root dir file.
     *
     * @return the root dir file
     *
     * @throws IOException
     *             Signals that an I/O exception has occurred.
     */
    public File getRootDirFile() throws IOException {
<span class="pc bpc" id="L341" title="1 of 2 branches missed.">        return rootDir.startsWith(&quot;..&quot;) ? Path.of(rootDir).toFile().getCanonicalFile() : Path.of(rootDir).toFile();</span>
    }

    /**
     * Checks for root dir.
     *
     * @return true, if successful
     */
    public boolean hasRootDir() {
<span class="fc" id="L350">        return StringUtils.isNotBlank(rootDir);</span>
    }

    /**
     * Gets the css files.
     *
     * @return the css files
     */
    public List&lt;String&gt; getCssFiles() {
<span class="fc" id="L359">        return cssFiles;</span>
    }

    /**
     * Checks for css files.
     *
     * @return true, if successful
     */
    public boolean hasCssFiles() {
<span class="pc bpc" id="L368" title="1 of 4 branches missed.">        return cssFiles != null &amp;&amp; !cssFiles.isEmpty();</span>
    }

    /**
     * Gets the output dir.
     *
     * @return the output dir
     */
    public String getOutputDir() {
<span class="fc" id="L377">        return outputDir;</span>
    }

    /**
     * Checks for output dir.
     *
     * @return true, if successful
     */
    public boolean hasOutputDir() {
<span class="fc" id="L386">        return StringUtils.isNotBlank(outputDir);</span>
    }

    /**
     * Gets the document root dir.
     *
     * @return the document root dir
     */
    public String getDocumentRootDir() {
<span class="fc" id="L395">        return documentRootDir;</span>
    }

    /**
     * Checks for document root dir.
     *
     * @return true, if successful
     */
    public boolean hasDocumentRootDir() {
<span class="fc" id="L404">        return StringUtils.isNotBlank(documentRootDir);</span>
    }

    /**
     * Gets the log level.
     *
     * @return the log level
     */
    public MessageLevel getLogLevel() {
<span class="nc" id="L413">        return logLevel;</span>
    }

    /**
     * Gets the css file suffix.
     *
     * @return the css file suffix
     */
    public String getCssFileSuffix() {
<span class="fc" id="L422">        return cssFileSuffix;</span>
    }

    /**
     * Gets the sprite png depth.
     *
     * @return the sprite png depth
     */
    public PngDepth getSpritePngDepth() {
<span class="fc" id="L431">        return spritePngDepth;</span>
    }

    /**
     * Checks if is mark sprite images.
     *
     * @return true, if is mark sprite images
     */
    public boolean isMarkSpriteImages() {
<span class="fc" id="L440">        return markSpriteImages;</span>
    }

    /**
     * Gets the css file encoding.
     *
     * @return the css file encoding
     */
    public String getCssFileEncoding() {
<span class="fc" id="L449">        return cssFileEncoding;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>